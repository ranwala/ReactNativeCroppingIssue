package io.scanbot.sdk.reactnative.components;

import android.view.ViewGroup;

import com.facebook.react.bridge.ReactContext;
import com.facebook.react.bridge.WritableMap;
import com.facebook.react.common.MapBuilder;
import com.facebook.react.uimanager.events.RCTEventEmitter;

import java.util.Map;

public class EventEmitter {

    public enum NativeEvent {
        BARCODE_SCANNER_RESULT("onBarcodeScannerResult"),
        REQUEST_COMPONENT_RELOAD("requestComponentReload");

        private final String name;
        NativeEvent(final String name) {
            this.name = name;
        }

        public String getName() {
            return name;
        }
    }

    private final RCTEventEmitter jsEventEmitter;
    private final ReactContext reactContext;
    private final ViewGroup rootViewGroup;

    public EventEmitter(final ReactContext reactContext, final ViewGroup rootViewGroup) {
        this.reactContext = reactContext;
        this.jsEventEmitter = reactContext.getJSModule(RCTEventEmitter.class);
        this.rootViewGroup = rootViewGroup;
    }

    public void emitEvent(final NativeEvent event, final WritableMap data) {
        assert reactContext != null;
        jsEventEmitter.receiveEvent(
                rootViewGroup.getId(),
                event.getName(),
                data);
    }

    public static Map<String, Object> getMapForNativeEvents(NativeEvent[] events) {
        MapBuilder.Builder<String, Object> builder = MapBuilder.builder();

        for (NativeEvent event: events) {
            builder.put(event.getName(), MapBuilder.of("registrationName", event.getName()));
        }

        return builder.build();
    }
}
