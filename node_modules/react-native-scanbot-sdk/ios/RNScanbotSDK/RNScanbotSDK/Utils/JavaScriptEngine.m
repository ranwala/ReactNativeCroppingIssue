//
//  JavaScriptEngine.m
//  RNScanbotSDK
//
//  Created by Marco Saia on 05.08.21.
//

#import "JavaScriptEngine.h"

@implementation JavaScriptEngine

+ (JSValue*)executeBlock:(NSString*)jsText withArguments:(NSArray<NSString*>*)arguments {
    JSContext* context = [self prepareContext];
    [context evaluateScript: jsText];
    JSValue *function = context[@"__execute__"];
    JSValue* result = [function callWithArguments:arguments];
    return result;
}

+ (JSValue*)executeBlock:(NSString*)jsText withArgument:(NSString*)argument {
    return [JavaScriptEngine executeBlock:jsText withArguments:@[argument]];
}

+ (JSContext*) prepareContext {
    JSContext *context = [[JSContext alloc] init];
    [context evaluateScript:@"function __scanbotSDKLog__(msg) {}; const console={log:(text)=>{__scanbotSDKLog__(text);}};"];
    context[@"__scanbotSDKLog__"] = ^(NSString* arg) {
        [JavaScriptEngine logMessage:arg];
    };
    return context;
}

+ (void) logMessage:(NSString*)msg {
    NSLog(@"[ScanbotSDK] JS: %@", msg);
}

@end
