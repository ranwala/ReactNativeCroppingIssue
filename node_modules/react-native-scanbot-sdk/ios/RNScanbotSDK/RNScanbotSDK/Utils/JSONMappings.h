//
//  Scanbot SDK ReactNative Module
//
//  Copyright (c) 2018 doo GmbH. All rights reserved.
//

@import ScanbotSDK;

NSString* DetectionResultAsJSONStringValue(SBSDKDocumentDetectionStatus status);
NSString* PageImageSourceAsJSONStringValue(SBSDKPageImageSource pageImageSource);

NSString* ImageFilterAsJSONStringValue(SBSDKImageFilterType filter);
SBSDKImageFilterType filterIdFromFilterNameString(NSString* filterName);
SBSDKPDFRendererPageSize pageSizeFromPagesizeNameString(NSString* pageSizeName);

NSString* MRZFieldNameAsString(SBSDKMachineReadableZoneRecognizerFieldName name);

NSDictionary* dictionaryFromPage(SBSDKUIPage* page);
NSDictionary* dictionaryFromExtractedPage(SBSDKUIPage* page);

SBSDKUIPage* pageFromDictionary(NSDictionary* dict);

NSString* MRZDocumentTypeAsString(SBSDKMachineReadableZoneRecognizerResultDocumentType documentType);
NSDictionary* MRZRecognizerResultAsDictionary(SBSDKMachineReadableZoneRecognizerResult* mrzResult);
NSDictionary* EHICRecognizerResultAsDictionary(SBSDKHealthInsuranceCardRecognitionResult* ehicResult);
NSArray* MapTextDataScannerResult(SBSDKUITextDataScannerStepResult* stepResult);

NSMutableDictionary<NSString*, NSString*>* extractIdCardScannerFieldProperties(NSDictionary* configuration, NSArray<SBSDKGenericDocumentRootType*> *genericTypes);
NSMutableDictionary<NSString*, NSString*>* extractIdCardScannerDocumentProperties(NSDictionary* configuration, NSArray<SBSDKGenericDocumentRootType*> *genericTypes);
SBSDKGenericDocumentRootType* gdrRootTypeFromString(NSString* string);
NSArray<SBSDKGenericDocumentRootType*>* gdrRootTypesFromJsonArray(NSArray<NSString*>* jsonArray);
NSArray<SBSDKGenericDocumentRootType*>* extractGdrDocumentTypes(NSDictionary* configuration);

NSDictionary* extractMedicalCertificateScannerResult(SBSDKMedicalCertificateRecognizerResult* result);

NSDictionary* CGSizeAsJson(CGSize size);
CGSize CGSizeFromJson(NSDictionary* json);

UIInterfaceOrientationMask orientationLockModeToUIInterfaceOrientationMaskFromConfig(NSDictionary* configuration, NSString* key);
UIInterfaceOrientationMask orientationLockModeToUIInterfaceOrientationMask(NSString* value);

NSArray* stringArrayFromNSURLArray(NSArray* urls);

SBSDKTIFFImageWriterCompressionOptions tiffCompressionOptionFromStringName(NSString* compressionName, SBSDKTIFFImageWriterCompressionOptions defaultValue);


void mapMedicalCertificateErrorDialogTexts(NSDictionary *configuration, SBSDKUIMedicalCertificateScannerTextConfiguration *textConfig);

void mapMedicalCertificateGuidanceTexts(NSDictionary *configuration, SBSDKUIMedicalCertificateScannerTextConfiguration *textConfig);

static inline NSArray<SBSDKUIPage *>* pagesFromJsonArray(NSArray* jsonPages) {
    if (jsonPages == nil || [jsonPages count] == 0) {
        return nil;
    }

    NSMutableArray<SBSDKUIPage *> *sdkPages = [NSMutableArray new];
    for (NSDictionary* p in jsonPages) {
        [sdkPages addObject:pageFromDictionary(p)];
    }

    return sdkPages;
}

static inline SBSDKDocumentDetectionStatus detectionStatusFromJSONString(NSString* detectionResult) {
    if (!detectionResult) {
        return SBSDKDocumentDetectionStatusNotAcquired;
    }
    if ([detectionResult isEqualToString:@"OK"]) return SBSDKDocumentDetectionStatusOK;
    if ([detectionResult isEqualToString:@"OK_BUT_TOO_SMALL"]) return SBSDKDocumentDetectionStatusOK_SmallSize;
    if ([detectionResult isEqualToString:@"OK_BUT_BAD_ANGLES"]) return SBSDKDocumentDetectionStatusOK_BadAngles;
    if ([detectionResult isEqualToString:@"OK_BUT_BAD_ASPECT_RATIO"]) return SBSDKDocumentDetectionStatusOK_BadAspectRatio;
    if ([detectionResult isEqualToString:@"OK_OFF_CENTER"]) return SBSDKDocumentDetectionStatusOK_OffCenter;
    if ([detectionResult isEqualToString:@"ERROR_NOTHING_DETECTED"]) return SBSDKDocumentDetectionStatusError_NothingDetected;
    if ([detectionResult isEqualToString:@"ERROR_TOO_DARK"]) return SBSDKDocumentDetectionStatusError_Brightness;
    if ([detectionResult isEqualToString:@"ERROR_TOO_NOISY"]) return SBSDKDocumentDetectionStatusError_Noise;
    return SBSDKDocumentDetectionStatusNotAcquired;
}
